<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Корзина Wildberries</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #8a2be2;
        }
        .cart-icon {
            position: relative;
            cursor: pointer;
        }
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #ff3b30;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
        }
        .main-content {
            display: flex;
            gap: 20px;
            margin: 30px 0;
        }
        .cart-section {
            flex: 3;
            background-color: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .order-section {
            flex: 2;
            background-color: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            align-self: flex-start;
            position: sticky;
            top: 80px;
        }
        .section-title {
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .cart-items {
            margin-bottom: 20px;
        }
        .cart-item {
            display: flex;
            align-items: flex-start;
            padding: 20px 0;
            border-bottom: 1px solid #eee;
            gap: 20px;
        }
        .cart-item-image {
            width: 140px;
            height: 140px;
            object-fit: contain;
            border-radius: 12px;
            background-color: #f9f9f9;
            padding: 10px;
            flex-shrink: 0;
        }
        .cart-item-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .cart-item-title {
            font-size: 18px;
            margin-bottom: 5px;
            line-height: 1.4;
        }
        .cart-item-price {
            font-size: 18px;
            color: #8a2be2;
            font-weight: bold;
        }
        .quantity-controls {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .quantity-btn {
            width: 36px;
            height: 36px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
            font-weight: bold;
        }
        .quantity-btn:hover {
            background-color: #e0e0e0;
        }
        .quantity-input {
            width: 50px;
            height: 36px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin: 0 8px;
            font-size: 16px;
        }
        .remove-item {
            color: #ff3b30;
            background: none;
            border: 1px solid #ff3b30;
            cursor: pointer;
            font-size: 14px;
            padding: 8px 12px 8px 32px;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            position: relative;
            align-self: flex-start;
        }
        .remove-item::before {
            content: "";
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ff3b30'%3E%3Cpath d='M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            transition: all 0.3s ease;
        }
        .remove-item:hover {
            background-color: #ff3b30;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(255, 59, 48, 0.3);
        }
        .remove-item:hover::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z'/%3E%3C/svg%3E");
        }
        .remove-item:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(255, 59, 48, 0.3);
        }
        .add-to-cart-btn {
            color: #8a2be2;
            background: none;
            border: 1px solid #8a2be2;
            cursor: pointer;
            font-size: 14px;
            padding: 8px 12px 8px 32px;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            position: relative;
        }
        .add-to-cart-btn::before {
            content: "";
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%238a2be2'%3E%3Cpath d='M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            transition: all 0.3s ease;
        }
        .add-to-cart-btn:hover {
            background-color: #8a2be2;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(138, 43, 226, 0.3);
        }
        .add-to-cart-btn:hover::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z'/%3E%3C/svg%3E");
        }
        .add-to-cart-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(138, 43, 226, 0.3);
        }
        .delete-from-saved {
            color: #ff3b30;
            background: none;
            border: 1px solid #ff3b30;
            cursor: pointer;
            font-size: 14px;
            padding: 8px 12px 8px 32px;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            position: relative;
        }
        .delete-from-saved::before {
            content: "";
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ff3b30'%3E%3Cpath d='M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            transition: all 0.3s ease;
        }
        .delete-from-saved:hover {
            background-color: #ff3b30;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(255, 59, 48, 0.3);
        }
        .delete-from-saved:hover::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z'/%3E%3C/svg%3E");
        }
        .delete-from-saved:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(255, 59, 48, 0.3);
        }
        .order-summary {
            border-top: 1px solid #eee;
            padding-top: 15px;
            margin-top: 20px;
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
        }
        .total-row {
            font-weight: bold;
            font-size: 18px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        .checkout-btn {
            width: 100%;
            padding: 15px;
            background-color: #8a2be2;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        .checkout-btn:hover {
            background-color: #7a1bd2;
        }
        .empty-cart {
            text-align: center;
            padding: 30px 0;
            color: #888;
        }
        .customer-info {
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        } 
        .form-input:focus {
            outline: none;
            border-color: #8a2be2;
            box-shadow: 0 0 0 2px rgba(138, 43, 226, 0.1);
        }
        .form-input.error {
            border-color: #ff3b30;
        }
        .error-message {
            color: #ff3b30;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .promo-code {
            margin-top: 20px;
        }
        .promo-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 16px;
        }
        .apply-promo {
            width: 100%;
            padding: 12px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
        }
        .apply-promo:hover {
            background-color: #e0e0e0;
        }
        .discount-info {
            color: #28a745;
            font-size: 14px;
            margin-top: 5px;
        }
        .saved-items-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        .saved-items {
            margin-bottom: 20px;
        }
        .saved-item {
            display: flex;
            align-items: flex-start;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
            gap: 15px;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }
        .saved-item:hover {
            opacity: 1;
        }
        .saved-item-image {
            width: 100px;
            height: 100px;
            object-fit: contain;
            border-radius: 8px;
            background-color: #f9f9f9;
            padding: 8px;
            flex-shrink: 0;
        }
        .saved-item-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .saved-item-title {
            font-size: 16px;
            line-height: 1.4;
        }
        .saved-item-price {
            font-size: 16px;
            color: #8a2be2;
            font-weight: bold;
        }
        .saved-item-actions {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
        .no-saved-items {
            text-align: center;
            padding: 20px 0;
            color: #888;
            font-style: italic;
        }
        /* Стили для чекбокса согласия */
        .agreement-group {
            margin: 20px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        .agreement-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .agreement-checkbox input {
            margin-top: 3px;
        }
        .agreement-text {
            font-size: 14px;
            line-height: 1.4;
        }
        .agreement-link {
            color: #8a2be2;
            text-decoration: none;
        }
        .agreement-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- Шапка сайта -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Wildberries</div>
                <div class="cart-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.4 5.2 16.4H17M17 16C15.9 16 15 16.9 15 18C15 19.1 15.9 20 17 20C18.1 20 19 19.1 19 18C19 16.9 18.1 16 17 16ZM9 18C9 19.1 8.1 20 7 20C5.9 20 5 19.1 5 18C5 16.9 5.9 16 7 16C8.1 16 9 16.9 9 18Z" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <div class="cart-count">0</div>
                </div>
            </div>
        </div>
    </header>
    <!-- Основной контент -->
    <div class="container">
        <div class="main-content">
            <!-- Секция корзины -->
            <section class="cart-section">
                <h2 class="section-title">Корзина</h2>
                <div class="cart-items" id="cart-items">
                    <div class="empty-cart">Ваша корзина пуста</div>
                </div>
                <!-- Секция отложенных товаров -->
                <div class="saved-items-section" id="saved-items-section" style="display: none;">
                    <h2 class="section-title">Отложенные товары</h2>
                    <div class="saved-items" id="saved-items">
                        <div class="no-saved-items">Нет отложенных товаров</div>
                    </div>
                </div>
            </section>
            <!-- Секция оформления заказа -->
            <section class="order-section">
                <h2 class="section-title">Оформление заказа</h2>
                <!-- Информация о покупателе -->
                <div class="customer-info">
                    <div class="form-group">
                        <label class="form-label" for="full-name">Имя *</label>
                        <input type="text" class="form-input" id="full-name" placeholder="Иван">
                        <div class="error-message" id="full-name-error">Пожалуйста, введите ваше имя</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="phone">Телефон *</label>
                        <input type="tel" class="form-input" id="phone" placeholder="+7 (999) 999-99-99">
                        <div class="error-message" id="phone-error">Пожалуйста, введите корректный номер телефона</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="address">Адрес доставки *</label>
                        <input type="text" class="form-input" id="address" placeholder="г. Москва, ул. Примерная, д. 1, кв. 1">
                        <div class="error-message" id="address-error">Пожалуйста, введите адрес доставки</div>
                    </div>
                    <!-- Чекбокс согласия с правилами -->
                    <div class="agreement-group">
                        <div class="agreement-checkbox">
                            <input type="checkbox" id="agreement-checkbox">
                            <label for="agreement-checkbox" class="agreement-text">
                                Я согласен(а) с <a href="#" class="agreement-link">правилами работы площадки</a> и 
                                <a href="#" class="agreement-link">политикой конфиденциальности</a>
                            </label>
                        </div>
                        <div class="error-message" id="agreement-error">Необходимо согласие с правилами работы площадки</div>
                    </div>
                </div>
                <!-- Сводка заказа -->
                <div class="order-summary" id="order-summary" style="display: none;">
                    <div class="summary-row">
                        <span>Товары (<span id="total-items-count">0</span> шт.)</span>
                        <span id="subtotal-price">0 ₽</span>
                    </div>
                    <div class="summary-row">
                        <span>Скидка</span>
                        <span id="discount-price">0 ₽</span>
                    </div>
                    <div class="summary-row">
                        <span>Доставка</span>
                        <span id="shipping-price">0 ₽</span>
                    </div>
                    <div class="summary-row total-row">
                        <span>Итого</span>
                        <span id="total-price">0 ₽</span>
                    </div>
                </div>
                <!-- Промокод -->
                <div class="promo-code">
                    <input type="text" class="promo-input" id="promo-input" placeholder="Промокод">
                    <button class="apply-promo" id="apply-promo">Применить</button>
                    <div class="error-message" id="promo-error">Неверный промокод</div>
                    <div class="discount-info" id="discount-info"></div>
                </div>
                <!-- Кнопка оформления заказа -->
                <button class="checkout-btn" id="checkout-btn">Оформить заказ</button>
            </section>
        </div>
    </div>
    <script>
        // Данные товаров
        const products = [
            {
                id: 1,
                name: "Смартфон Samsung Galaxy A54 5G 128GB",
                price: 24999,
                image: "1.jpg"
            },
            {
                id: 2,
                name: "Наушники Apple AirPods Pro 2",
                price: 18999,
                image: "2.webp"
            },
            {
                id: 3,
                name: "Умные часы Apple Watch Series 8",
                price: 31999,
                image: "3.webp"
            },
            {
                id: 4,
                name: "Ноутбук ASUS VivoBook 15",
                price: 45999,
                image: "4.webp"
            },
            {
                id: 5,
                name: "Фитнес-браслет Xiaomi Mi Band 7",
                price: 3499,
                image: "5.jpg"
            },
            {
                id: 6,
                name: "Игровая консоль Sony PlayStation 5",
                price: 54999,
                image: "6.jpg"
            },
            {
                id: 7,
                name: "Планшет Apple iPad Air 10.9",
                price: 62999,
                image: "7.jpg"
            },
            {
                id: 8,
                name: "Камера Canon EOS R6",
                price: 189999,
                image: "8.webp"
            },
            {
                id: 9,
                name: "Монитор Dell 27 4K",
                price: 43999,
                image: "9.jpg"
            },
            {
                id: 10,
                name: "Клавиатура Logitech MX Keys",
                price: 11999,
                image: "10.webp"
            }
        ];
        // Корзина и отложенные товары
        let cart = [];
        let savedItems = [];
        let appliedPromo = null;
        let discountAmount = 0;
        let freeItemId = null;
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            // Добавляем 10 товаров в корзину для демонстрации (по одному каждого товара)
            for (let i = 1; i <= 10; i++) {
                addToCart(i);
            }
            updateCart();
            // Обработчик кнопки оформления заказа
            document.getElementById('checkout-btn').addEventListener('click', () => {
                if (!validateForm()) {
                    return;
                }
                if (cart.length === 0) {
                    alert('Корзина пуста');
                    return;
                }
                const customerData = {
                    fullName: document.getElementById('full-name').value,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value
                };
                alert(`Заказ оформлен!\n\nИмя: ${customerData.fullName}\nТелефон: ${customerData.phone}\nАдрес: ${customerData.address}\n\nСпасибо за покупку!`);
                // Очистка данных
                cart = [];
                savedItems = [];
                appliedPromo = null;
                discountAmount = 0;
                freeItemId = null;
                document.getElementById('full-name').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('address').value = '';
                document.getElementById('promo-input').value = '';
                document.getElementById('discount-info').textContent = '';
                document.getElementById('agreement-checkbox').checked = false;
                updateCart();
            });
            // Обработчик применения промокода
            document.getElementById('apply-promo').addEventListener('click', applyPromoCode);
            // Маска для телефона
            document.getElementById('phone').addEventListener('input', function(e) {
                let x = e.target.value.replace(/\D/g, '').match(/(\d{0,1})(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})/);
                e.target.value = '+7' + (x[2] ? ' (' + x[2] : '') + (x[3] ? ') ' + x[3] : '') + (x[4] ? '-' + x[4] : '') + (x[5] ? '-' + x[5] : '');
            });
        });
        // Валидация формы
        function validateForm() {
            let isValid = true;
            // Валидация Имя
            const fullName = document.getElementById('full-name').value.trim();
            const fullNameError = document.getElementById('full-name-error');
            if (fullName === '') {
                fullNameError.style.display = 'block';
                document.getElementById('full-name').classList.add('error');
                isValid = false;
            } else {
                fullNameError.style.display = 'none';
                document.getElementById('full-name').classList.remove('error');
            }
            // Валидация телефона
            const phone = document.getElementById('phone').value.trim();
            const phoneError = document.getElementById('phone-error');
            const phoneRegex = /^\+7 \(\d{3}\) \d{3}-\d{2}-\d{2}$/;
            if (!phoneRegex.test(phone)) {
                phoneError.style.display = 'block';
                document.getElementById('phone').classList.add('error');
                isValid = false;
            } else {
                phoneError.style.display = 'none';
                document.getElementById('phone').classList.remove('error');
            }
            // Валидация адреса
            const address = document.getElementById('address').value.trim();
            const addressError = document.getElementById('address-error');
            if (address === '') {
                addressError.style.display = 'block';
                document.getElementById('address').classList.add('error');
                isValid = false;
            } else {
                addressError.style.display = 'none';
                document.getElementById('address').classList.remove('error');
            }
            // Валидация чекбокса согласия
            const agreementCheckbox = document.getElementById('agreement-checkbox');
            const agreementError = document.getElementById('agreement-error');
            if (!agreementCheckbox.checked) {
                agreementError.style.display = 'block';
                isValid = false;
            } else {
                agreementError.style.display = 'none';
            }
            return isValid;
        }
        // Добавление товара в корзину
        function addToCart(productId, quantity = 1) {
            const product = products.find(p => p.id === productId);
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                // Проверяем, есть ли товар в отложенных
                const savedItemIndex = savedItems.findIndex(item => item.id === productId);
                if (savedItemIndex !== -1) {
                    // Удаляем из отложенных
                    savedItems.splice(savedItemIndex, 1);
                }
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.image,
                    quantity: quantity
                });
            }
            updateCart();
        }
        // Обновление корзины
        function updateCart() {
            const cartItems = document.getElementById('cart-items');
            const orderSummary = document.getElementById('order-summary');
            const cartCount = document.querySelector('.cart-count');
            const savedItemsSection = document.getElementById('saved-items-section');
            // Обновление счетчика товаров в хедере
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            // Если корзина пуста
            if (cart.length === 0 && savedItems.length === 0) {
                cartItems.innerHTML = '<div class="empty-cart">Ваша корзина пуста</div>';
                orderSummary.style.display = 'none';
                savedItemsSection.style.display = 'none';
                return;
            }
            // Отображение товаров в корзине
            cartItems.innerHTML = '';
            // Активные товары в корзине (количество > 0)
            const activeCartItems = cart.filter(item => item.quantity > 0);
            if (activeCartItems.length === 0) {
                cartItems.innerHTML = '<div class="empty-cart">Ваша корзина пуста</div>';
            } else {
                activeCartItems.forEach(item => {
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    // Проверяем, является ли товар бесплатным
                    const isFree = freeItemId === item.id;
                    const displayPrice = isFree ? 0 : item.price;
                    cartItem.innerHTML = `
                        <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                        <div class="cart-item-details">
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-price">${isFree ? '<s>' + item.price.toLocaleString() + ' ₽</s> 0 ₽' : displayPrice.toLocaleString() + ' ₽'}</div>
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" data-id="${item.id}">-</button>
                                <input type="text" class="quantity-input" value="${item.quantity}" data-id="${item.id}">
                                <button class="quantity-btn plus" data-id="${item.id}">+</button>
                            </div>
                            <button class="remove-item" data-id="${item.id}">Удалить</button>
                        </div>
                    `;
                    cartItems.appendChild(cartItem);
                });
            }
            // Отображение отложенных товаров
            updateSavedItems();
            // Показываем/скрываем блок отложенных товаров
            if (savedItems.length > 0) {
                savedItemsSection.style.display = 'block';
            } else {
                savedItemsSection.style.display = 'none';
            }
            // Добавление обработчиков событий для кнопок в корзине
            document.querySelectorAll('.quantity-btn.minus').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    updateQuantity(productId, -1);
                });
            });
            document.querySelectorAll('.quantity-btn.plus').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    updateQuantity(productId, 1);
                });
            });
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    removeFromCart(productId);
                });
            });
            // Обновление итоговой суммы
            updateOrderSummary();
            orderSummary.style.display = 'block';
        }
        // Обновление отложенных товаров
        function updateSavedItems() {
            const savedItemsContainer = document.getElementById('saved-items');
            if (savedItems.length === 0) {
                savedItemsContainer.innerHTML = '<div class="no-saved-items">Нет отложенных товаров</div>';
                return;
            }
            savedItemsContainer.innerHTML = '';
            savedItems.forEach(item => {
                const savedItem = document.createElement('div');
                savedItem.className = 'saved-item';
                savedItem.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="saved-item-image">
                    <div class="saved-item-details">
                        <div class="saved-item-title">${item.name}</div>
                        <div class="saved-item-price">${item.price.toLocaleString()} ₽</div>
                        <div class="saved-item-actions">
                            <button class="add-to-cart-btn" data-id="${item.id}">В корзину</button>
                            <button class="delete-from-saved" data-id="${item.id}">Удалить</button>
                        </div>
                    </div>
                `;
                savedItemsContainer.appendChild(savedItem);
            });
            // Добавление обработчиков для кнопок отложенных товаров
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    addToCart(productId, 1);
                });
            });
            document.querySelectorAll('.delete-from-saved').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    deleteFromSaved(productId);
                });
            });
        }
        // Обновление количества товара
        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    // Перемещаем товар в отложенные
                    moveToSavedItems(productId);
                } else {
                    updateCart();
                }
            }
        }
        // Перемещение товара в отложенные
        function moveToSavedItems(productId) {
            const itemIndex = cart.findIndex(item => item.id === productId);
            if (itemIndex !== -1) {
                const item = cart[itemIndex];
                // Проверяем, нет ли уже этого товара в отложенных
                const existingSavedItem = savedItems.find(savedItem => savedItem.id === productId);
                if (!existingSavedItem) {
                    // Добавляем в отложенные
                    savedItems.push({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        image: item.image
                    });
                }
                // Удаляем из корзины
                cart.splice(itemIndex, 1);
                // Если удален бесплатный товар, сбрасываем промокод
                if (freeItemId === productId) {
                    appliedPromo = null;
                    discountAmount = 0;
                    freeItemId = null;
                    document.getElementById('promo-input').value = '';
                    document.getElementById('discount-info').textContent = '';
                }
                updateCart();
            }
        }
        // Удаление товара из корзины (полное удаление)
        function removeFromCart(productId) {
            const itemIndex = cart.findIndex(item => item.id === productId);
            if (itemIndex !== -1) {
                const item = cart[itemIndex];
                // Добавляем товар в отложенные при удалении
                const existingSavedItem = savedItems.find(savedItem => savedItem.id === productId);
                if (!existingSavedItem) {
                    savedItems.push({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        image: item.image
                    });
                }
                // Удаляем из корзины
                cart.splice(itemIndex, 1);
                // Если удален бесплатный товар, сбрасываем промокод
                if (freeItemId === productId) {
                    appliedPromo = null;
                    discountAmount = 0;
                    freeItemId = null;
                    document.getElementById('promo-input').value = '';
                    document.getElementById('discount-info').textContent = '';
                }
                updateCart();
            }
        }
        // Удаление товара из отложенных
        function deleteFromSaved(productId) {
            const savedItemIndex = savedItems.findIndex(item => item.id === productId);
            if (savedItemIndex !== -1) {
                savedItems.splice(savedItemIndex, 1);
                updateCart();
            }
        }
        // Обновление итоговой суммы
        function updateOrderSummary() {
            // Общее количество товаров (сумма всех quantity)
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            // Рассчитываем стоимость товаров с учетом бесплатного товара
            let subtotal = cart.reduce((sum, item) => {
                if (freeItemId === item.id) {
                    return sum; // Бесплатный товар не учитывается в стоимости
                }
                return sum + (item.price * item.quantity);
            }, 0);
            // Применяем скидку если есть
            if (appliedPromo === 'sale10') {
                discountAmount = subtotal * 0.1;
            } else if (appliedPromo === 'happyhappyhappy') {
                discountAmount = subtotal * 0.5;
            } else {
                discountAmount = 0;
            }
            const finalSubtotal = subtotal - discountAmount;
            const shipping = finalSubtotal > 2000 ? 0 : 299; // Бесплатная доставка от 2000 рублей
            const total = finalSubtotal + shipping;
            // Обновляем элементы в блоке оформления заказа
            document.getElementById('total-items-count').textContent = totalItems;
            document.getElementById('subtotal-price').textContent = subtotal.toLocaleString() + ' ₽';
            document.getElementById('discount-price').textContent = '-' + discountAmount.toLocaleString() + ' ₽';
            document.getElementById('shipping-price').textContent = shipping === 0 ? 'Бесплатно' : shipping.toLocaleString() + ' ₽';
            document.getElementById('total-price').textContent = total.toLocaleString() + ' ₽';
        }
        // Применение промокода
        function applyPromoCode() {
            const promoInput = document.getElementById('promo-input');
            const promoError = document.getElementById('promo-error');
            const discountInfo = document.getElementById('discount-info');
            const promoCode = promoInput.value.trim();
            // Сбрасываем предыдущий промокод
            appliedPromo = null;
            discountAmount = 0;
            freeItemId = null;
            // Проверяем промокоды
            if (promoCode === 'sale10') {
                appliedPromo = 'sale10';
                discountInfo.textContent = 'Применена скидка 10% на весь заказ';
                promoError.style.display = 'none';
            } else if (promoCode === 'freesecond') {
                appliedPromo = 'freesecond';
                // Находим самый дешевый товар
                if (cart.length > 0) {
                    const cheapestItem = cart.reduce((prev, current) => 
                        (prev.price < current.price) ? prev : current
                    );
                    freeItemId = cheapestItem.id;
                    discountInfo.textContent = `"${cheapestItem.name}" бесплатно!`;
                }
                promoError.style.display = 'none';
            } else if (promoCode === 'happyhappyhappy') {
                appliedPromo = 'happyhappyhappy';
                discountInfo.textContent = 'Применена скидка 50% на весь заказ';
                promoError.style.display = 'none';
            } else if (promoCode === '') {
                discountInfo.textContent = '';
                promoError.style.display = 'none';
            } else {
                discountInfo.textContent = '';
                promoError.style.display = 'block';
            } 
            updateCart();
        }
    </script>
</body>
</html>